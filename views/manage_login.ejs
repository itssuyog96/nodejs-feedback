<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<% include tpl/header.ejs %>

<body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid">
<!-- BEGIN HEADER -->

<% include tpl/menu.ejs %>

<!-- END HEADER -->


<!-- BEGIN HEADER & CONTENT DIVIDER -->
<div class="clearfix"></div>
<!-- END HEADER & CONTENT DIVIDER -->

<!-- BEGIN CONTAINER -->
<div class="page-container">
    <% include tpl/sidebar.ejs %>
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <div class="page-content">
            <!-- BEGIN PAGE HEADER-->

            <!--h3 class="page-title"> Blank Page Layout
                <small>blank page layout</small>        To be resolved
            </h3-->

            <!-- END PAGE HEADER-->


            <!--START EDITING FROM HERE-->

            <div class="portlet light">
                <div class="portlet-title">
                    <div class="caption font-dark">
                        <i class="icon-settings font-dark"></i>
                        <span class="caption-subject bold uppercase">User Table</span>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="user-table"
                                   class="table table-striped table-bordered table-hover table-checkable order-column">
                                <thead>
                                <tr>
                                    <th>Sr.No.</th>
                                    <th>College Id</th>
                                    <th>Department Id</th>
                                    <th>Name</th>
                                    <th>Username</th>
                                    <th>Mobile</th>
                                    <th>Email Id</th>
                                    <th>Send Link</th>
                                    <th>Generate &amp; Send Link</th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-12">
                            <a id="col_modal_btn" class="btn green btn-outline" data-toggle="modal"
                               data-target="#add_user">ADD USER</a>
                        </div>
                    </div>
                </div>
            </div>


            <!--STOP EDITING HERE-->

        </div>
        <!-- END CONTENT BODY -->
    </div>
    <!-- END CONTENT -->
    <% include tpl/quicksidebar.ejs %>
</div>

<!-- END CONTAINER -->

<!-- Add user modal -->
<div class="modal fade div_user_add" id="add_user" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Add New User</h4>
            </div>
            <div class="modal-body">
                <form id="form-user_add">

                    <div class="form-group col-md-12">
                        <div class="form-group col-md-4">
                            <label for="col_id" class="form-control">College ID</label>
                        </div>
                        <div class="form-group col-md-7">
                            <input type="text" name="col_id" class="form-control " required/>
                        </div>
                    </div>
                    <div class="form-group col-md-12">
                        <div class="form-group col-md-4">
                            <label for="dept_id" class="form-control">Department ID</label>
                        </div>
                        <div class="form-group col-md-7">
                            <input type="text" name="dept_id" class="form-control " required/>
                        </div>
                    </div>
                    <div class="form-group col-md-12">
                        <div class="form-group col-md-4">
                            <label for="name" class="form-control">Name</label>
                        </div>
                        <div class="form-group col-md-7">
                            <input type="text" name="name" class="form-control " required/>
                        </div>
                    </div>
                    <div class="form-group col-md-12">
                        <div class="form-group col-md-4">
                            <label for="username" class="form-control">Username</label>
                        </div>
                        <div class="form-group col-md-7">
                            <input type="text" name="username" class="form-control " required/>
                        </div>
                    </div>
                    <div class="form-group col-md-12">
                        <div class="form-group col-md-4">
                            <label for="contact" class="form-control">Contact</label>
                        </div>
                        <div class="form-group col-md-7">
                            <input type="text" name="contact" class="form-control " required/>
                        </div>
                    </div>
                    <div class="form-group col-md-12">
                        <div class="form-group col-md-4">
                            <label for="email_id" class="form-control">E-mail ID</label>
                        </div>
                        <div class="form-group col-md-7">
                            <input type="email" name="email_id" class="form-control " required/>
                        </div>
                    </div>


                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn dark btn-outline close-user_add" data-dismiss="modal">Close</button>
                <button type="button" class="btn green user_add">Save changes</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->


<!-- END MODALS -->

<% include tpl/footer.ejs %>

<script src="../javascripts/global/scripts/datatable.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>

<script>

    function load_users() {
        var i = 1;
        $("#user-table").DataTable().destroy();
        $("#user-table").DataTable({
            ajax: {
                data: {col_id: 1},
                url: '../ajax/load_users',
                method: 'POST'
            },
            columns: [
                {
                    data: function () {
                        return i++;
                    }
                },

                {data: "col_id"},
                {data: "dept_id"},
                {data: "name"},
                {data: "username"},
                {data: "contact"},
                {data: "email_id"},

                {
                    data: function (data) {
                        var btn = '<a class="btn blue btn-outline" href="javascript:send('+data.col_id+','+data.username+')" target="_blank">SEND</a>';
                    }
                },
                {
                    data: function (data) {
                        var btn = '<a class="btn blue btn-outline" href="" target="_blank">GENERATE & SEND</a>';
                    }
                }
            ]
        });
    }

    load_users();

</script>

<script>

    $('.div_add_user').on('click', '.user_add', function(e){
        e.preventDefault();

        $.ajax({
            url: '../ajax/add_user',
            data: $('#form-add-user').serialize(),
            method: 'POST',
            success: function(data){
                load_users();
            },
            error: function(data){
                console.log("Error occured while adding user! "+data.responseText);
            }
        });
    });

</script>

</body>

</html>