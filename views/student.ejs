<!DOCTYPE html>

<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <meta charset="utf-8" />
    <title>FeedBack System | Student</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <!-- BEGIN LAYOUT FIRST STYLES -->
    <link href="//fonts.googleapis.com/css?family=Oswald:400,300,700" rel="stylesheet" type="text/css" />
    <!-- END LAYOUT FIRST STYLES -->
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    <link href="../../stylesheets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../../stylesheets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../../stylesheets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../stylesheets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN THEME GLOBAL STYLES -->
    <link href="../../stylesheets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="../../stylesheets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME GLOBAL STYLES -->
    <!-- BEGIN THEME LAYOUT STYLES -->
    <link href="../../stylesheets/layouts/layout5/css/layout.min.css" rel="stylesheet" type="text/css" />
    <link href="../../stylesheets/layouts/layout5/css/custom.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME LAYOUT STYLES -->
    <link href="../../bower_components/bootstrap-star-rating/css/star-rating.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="favicon.ico" /> </head>
<!-- END HEAD -->

<body class="page-header-fixed page-sidebar-closed-hide-logo">
<!-- BEGIN CONTAINER -->
<div class="wrapper">
    <!-- BEGIN HEADER -->
    <header class="page-header">
        <nav class="navbar mega-menu" role="navigation">
            <div class="container-fluid">

                <div class="clearfix navbar-fixed-top">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="toggle-icon">
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </span>
                    </button>
                    <!-- End Toggle Button -->
                    <!-- BEGIN LOGO -->
                    <a id="index" class="page-logo" href="http://bvcoenm.org.in/" target="_blank">
                        <img src="../../logo/logo.png" alt="Logo"> </a>
                    <!-- END LOGO -->

                    <!-- BEGIN TOPBAR ACTIONS -->
                    <div class="topbar-actions">
                        <!-- BEGIN USER PROFILE -->
                        <div class="btn-group-img btn-group">
                            <button type="button" class="btn btn-sm md-skip dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                <span><%= user.namex %></span>
                                <img src="../../profile/profile.png" alt=""> </button>
                            <ul class="dropdown-menu-v2" role="menu">
                                <li>
                                    <a data-toggle="modal" href="#myProfile">
                                        <i class="icon-user"></i> My Profile
                                    </a>
                                </li>
                                <li class="divider"> </li>

                                <li>
                                    <a href="../../logout">
                                        <i class="icon-key"></i> Log Out </a>
                                </li>
                            </ul>
                        </div>
                        <!-- END USER PROFILE -->

                    </div>
                    <!-- END TOPBAR ACTIONS -->
                </div>
            </div>
            <!--/container-->
        </nav>
    </header>
    <!-- END HEADER -->

    <% function ObjectLength( object ) {
        var length = 0;
        for( var key in object ) {
            if( object.hasOwnProperty(key) ) {
                ++length;
            }
        }
        return length;
    }; %>

    <div class="container-fluid">
        <div class="page-content">

            <!-- BEGIN SIDEBAR CONTENT LAYOUT -->
            <div class="page-content-container">
                <div class="page-content-row">
                    <div class="page-content-col">
                        <!-- BEGIN PAGE BASE CONTENT -->
                        <form id="feedback_form">
                            <input type="hidden" name="col_id" value = "<%= user.col_id %>" />
                            <input type="hidden" name="dept_id" value = "<%= user.dep_id %>" />
                            <input type="hidden" name="sem" value = "<%= user.sem %>" />

                            <input type="hidden" name="sub_qty" value="<%= ObjectLength(subject) %>" />

                            <div class="portlet-body">

                            <div class="tabbable-custom nav-justified">
                                <ul class="nav nav-tabs nav-justified">
                                    <% var i = 0;
                                    subject.forEach(function(item){ %>
                                    <li <% if(i == 0) { %>
                                            class = "active"
                                            <% } %> ><a href="#tab-<%= item.sub_name %>" data-toggle="tab"><%= item.sub_name %></a></li>
                                    <% i++ %>
                                    <% }) %>

                                </ul>
                                <div class="panel-body tab-content feedback-panel">
                                    <% var i = 0;
                                    subject.forEach(function(item){ %>
                                    <div class="tab-pane <% if(i == 0){ %>
                                    active
                                <% }%>" id="tab-<%= item.sub_name %>">



                                        <div class="panel-body">

                                            <div class="row">
                                                <input name="sub_id_<%= i %>" value = "<%= item.sub_id %>" type="hidden">
                                                <input id = "sub_quesn_qty_<%= i %>" name="sub_quesn_qty_<%= i %>" value="0" type="hidden">

                                                <div class="col-md-12" id="quesns-<%= item.sub_name %>">

                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <% i++; }); %>


                                    <div class="panel-footer">
                                        <input class="btn btn-primary pull-right submit-feedback" name="submit" type="submit" value="Submit Feedback"/>
                                    </div>

                                </div>
                            </div>
                        </div>

                        </form>

                        <!-- END PAGE BASE CONTENT -->
                    </div>
                </div>
            </div>
            <!-- END SIDEBAR CONTENT LAYOUT -->
        </div>
        <!-- BEGIN FOOTER -->
        <p class="copyright" style="font-size: smaller; ">
            2016 Â© FeedBack System by the-wire.&nbsp;<a href="https://github.com/THE-WIRE" title="Produced with love" target="_blank">Produced with love</a>
        </p>
        <a href="#index" class="go2top">
            <i class="icon-arrow-up"></i>
        </a>
        <!-- END FOOTER -->
    </div>
</div>
<!-- END CONTAINER -->

<div class="modal fade bs-modal-lg" id="myProfile" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">MY PROFILE</h4>
            </div>
            <div class="modal-body">

                <table class="table table-responsive table-hover">
                    <tbody>
                    <tr>
                        <td>COLLEGE</td><td><%= user.col_name %></td>
                    </tr>
                    <tr>
                        <td>DEPARTMENT</td><td><%= user.dept_name %></td>
                    </tr>
                    <tr>
                        <td>
                            <table class="table table-responsive table-hover">
                                <thead>
                                    <tr>
                                        <th>SUBJECT ID</th>
                                        <th>SUBJECT NAME</th>
                                    </tr>
                                </thead>
                                <tbody>
                                <% subject.forEach(function(item){ %>
                                   <tr>
                                       <td><%= item.sub_id %></td><td><%= item.sub_name %></td>
                                   </tr>
                                <% }); %>
                                </tbody>
                            </table>
                        </td>
                        <td>
                            <table class="table table-responsive table-hover">
                                <thead>
                                <tr>
                                    <th>PROFESSOR ID</th>
                                    <th>PROFESSOR NAME</th>
                                </tr>
                                </thead>
                                <tbody>
                                <% subject.forEach(function(item){ %>
                                <tr>
                                    <td><%= item.sub_id %></td><td><%= item.sub_name %></td>
                                </tr>
                                <% }); %>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    </tbody>
                </table>

                        User ID Hash : <%= user._id %>
                        <hr>
                            Your identity is secure.
                        <hr>




            </div>
            <div class="modal-footer">
                <button type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<!--[if lt IE 9]>
<script src="../../javascripts/global/plugins/respond.min.js"></script>
<script src="../../javascripts/global/plugins/excanvas.min.js"></script>
<![endif]-->
<!-- BEGIN CORE PLUGINS -->
<script src="../../javascripts/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="../../javascripts/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../../javascripts/global/plugins/js.cookie.min.js" type="text/javascript"></script>
<script src="../../javascripts/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="../../javascripts/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="../../javascripts/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="../../javascripts/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="../../javascripts/global/scripts/app.min.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<script src="../../javascripts/layouts/layout5/scripts/layout.min.js" type="text/javascript"></script>
<!-- END THEME LAYOUT SCRIPTS -->

<script src="../../bower_components/bootstrap-star-rating/js/star-rating.js" type="text/javascript"></script>

<script>
    //Load Questions
    <% var j = -1; %>
    <% subject.forEach(function(item){
        j++;
    %>
    //Subject Name : <%= item.sub_name %>
    $.ajax({
        url : '../../ajax/getQuestions',
        data : {col_id : "<%= user.col_id %>", dep_id: "<%= user.dep_id %>", sub_id : "<%= item.sub_id %>", sem : "<%= user.sem %>" },
        method : 'POST',
        success : function(data){
            var i = 0;
            data.forEach(function(sub) {
                var k=1;
                if(sub.sub_id == <%= item.sub_id %>) {
                    $('#sub_quesn_qty_<%= j %>').val(parseInt($('#sub_quesn_qty_<%= j %>').val()) + 1);
                    $('#quesns-<%= item.sub_name %>').append(

                            '<div class="form-group col-md-12">' +
                                '<div class="well well-sm col-md-12 center">' +
                                    '<label class="control-label col-md-7 center"><strong>Q. ' + parseInt(++i) + '. ' + sub.question + '</strong></label>' +

                                    '<div class="col-md-5 row margin-bottom text-align-center">' +
                                        '<div class="col-md-12">' +

                                            '<input id="rate" name="rate" class="rating rating-loading star-rating-input" required>'+

                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>'
                    );
                }
                k++;
                });

            $('#quesns-<%= item.sub_name %>').append(
                    '<div class="form-group">'+
                    '<label class="col-md-3 control-label">Comments</label>'+
                    '<div class="col-md-9">'+
                    '<div class="col-md-9 col-xs-12">'+
                    '<textarea class="form-control" rows="5"></textarea>'+
                    '<span class="help-block">Please provide proper feedback</span>'+
            '</div>'+
            '</div>'+
            '</div>');

            $('.star-rating-input').rating({min:0, max:5, step:0.5, size:'xs',starCaptions : {
                0.5: '0.5 : Very Poor',
                        1: '1 : Poor',
                        1.5: '1.5 : Poor',
                        2: '2 : Below Average',
                        2.5: '2.5 : Average',
                        3: '3 : Can do better',
                        3.5: '3.5 : Good',
                        4: '4 : Very Good',
                        4.5: '4.5 : Excellent',
                        5: '5 : Perfect'
            }, starCaptionClasses: {
                0.5: 'label label-danger',
                1: 'label label-danger',
                1.5: 'label label-warning',
                2: 'label label-warning',
                2.5: 'label label-info',
                3: 'label label-info',
                3.5: 'label label-primary',
                4: 'label label-primary',
                4.5: 'label label-success',
                5: 'label label-success'
            }});

        },
        error : function(error){
            console.log("<%= item.sub_name %> : "+error.responseText);
        }
    });

    <% }); %>

</script>

<script>
    $('.feedback-panel').on('click', '.submit-feedback', function(e){

        $.ajax({
            url : '../../ajax/submit',
            data : $('#feedback_form').serialize(),
            method : 'POST',
            success:function () {
                console.log("done");
            }
        });
        //console.log(JSON.stringify($('#feedback_form').serialize()));
        e.preventDefault();
    });
</script>


</body>

</html>