<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<% include tpl/header.ejs %>
<link href="../stylesheets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css"/>
<link href="../stylesheets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet"
      type="text/css"/>
<link href="../stylesheets/global/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css" />

<body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid">
<!-- BEGIN HEADER -->

<% include tpl/menu.ejs %>

<!-- END HEADER -->


<!-- BEGIN HEADER & CONTENT DIVIDER -->
<div class="clearfix"></div>
<!-- END HEADER & CONTENT DIVIDER -->

<!-- BEGIN CONTAINER -->
<div class="page-container">
    <% include tpl/sidebar.ejs %>
    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <div class="page-content">
            <!-- BEGIN PAGE HEADER-->

            <!--h3 class="page-title"> Blank Page Layout
                <small>blank page layout</small>        To be resolved
            </h3-->

            <!-- END PAGE HEADER-->


            <!--START EDITING FROM HERE-->

            <div class="m-heading-1 border-green m-bordered">
                <h3>Data Entry Hub</h3>
                <p> All types of entries are done here. </p>
                <p> Start from selecting department in college table.
                    <a class="btn red btn-outline" href="#" target="_blank">for admins to enter college</a>
                </p>
            </div>

            <div class="portlet light div-<%= col.name %>">
                <div class="portlet-title">
                    <div class="caption font-dark">
                        <i class="icon-settings font-dark"></i>
                        <span class="caption-subject bold uppercase"> College Table</span>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="<%= col.name %>"
                                   class="table table-striped table-bordered table-hover table-checkable order-column">
                                <thead>
                                <tr>
                                    <% col.columns.forEach(function (items) { %>
                                    <th><%= items %></th>
                                    <% }); %>
                                </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-12">
                            <a id="col_modal_btn" class="btn green btn-outline" data-toggle="modal" data-target="#modal_colg">ADD COLLEGE</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="portlet light div-<%= dept.name %>">
                <div class="portlet-title">
                    <div class="caption font-dark">
                        <i class="icon-settings font-dark"></i>
                        <span class="caption-subject bold uppercase">Department Table</span>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="<%= dept.name %>"
                                   class="table table-striped table-bordered table-hover table-checkable order-column">
                                <thead>
                                <tr>
                                    <% dept.columns.forEach(function (items) { %>
                                    <th><%= items %></th>
                                    <% }); %>
                                </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-12">
                            <a class="btn green btn-outline" data-toggle="modal" data-target="#modal_dept">ADD DEPARTMENT</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="portlet light  div-<%= profs.name %>">
                <div class="portlet-title">
                    <div class="caption font-dark">
                        <i class="icon-settings font-dark"></i>
                        <span class="caption-subject bold uppercase">Professor Table</span>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="<%= profs.name %>"
                                   class="table table-striped table-bordered table-hover table-checkable order-column">
                                <thead>
                                <tr>
                                    <% profs.columns.forEach(function (items) { %>
                                    <th><%= items %></th>
                                    <% }); %>
                                </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-12">
                            <a class="btn green btn-outline" data-toggle="modal" data-target="#modal_prof">ADD PROFESSOR</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="portlet light div-<%= subj.name %>">
                <div class="portlet-title">
                    <div class="caption font-dark">
                        <i class="icon-settings font-dark"></i>
                        <span class="caption-subject bold uppercase">Subject Table</span>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="row">
                        <div class="col-md-12">
                            <table id="<%= subj.name %>"
                                   class="table table-striped table-bordered table-hover table-checkable order-column">
                                <thead>
                                <tr>
                                    <% subj.columns.forEach(function (items) { %>
                                    <th><%= items %></th>
                                    <% }); %>
                                </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="col-md-2 col-sm-2 col-xs-12">
                            <a class="btn green btn-outline" data-toggle="modal" data-target="#modal_subj">ADD SUBJECT</a>
                        </div>
                    </div>
                </div>
            </div>

            <!--STOP EDITING HERE-->

        </div>
        <!-- END CONTENT BODY -->
    </div>
    <!-- END CONTENT -->
    <% include tpl/quicksidebar.ejs %>
</div>

<!-- END CONTAINER -->


<!-- MODALS -->

<% for(a in mdata){ %>

<!-- Add <%= a %> modal -->
<div class="modal fade div_<%= mdata[a].class %>" id="<%= mdata[a].name %>" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title"><%= mdata[a].title %></h4>
            </div>
            <div class="modal-body">
                <form id="form-<%= mdata[a].class %>">

                    <% var y = mdata[a].form %>
                    <% for(key in y){ %>

                    <div class="form-group col-md-12">
                        <div class="form-group col-md-4">
                            <label for="<%= y[key] %>" class="form-control"><%= key %></label>
                        </div>
                        <div class="form-group col-md-7">
                            <input type="text" name="<%= y[key] %>" class="form-control <%= y[key] %>" required/>
                        </div>
                    </div>

                    <% } %>


                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn dark btn-outline close-<%= mdata[a].class %>" data-dismiss="modal">Close</button>
                <button type="button" class="btn green <%= mdata[a].class %>">Save changes</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<% } %>


<!-- END MODALS -->

<% include tpl/footer.ejs %>
<script src="../javascripts/global/scripts/datatable.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
<script src="../javascripts/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>

<script>

    $(".div-<%= dept.name %>").css("display", "none");
    $(".div-<%= profs.name %>").css("display", "none");
    $(".div-<%= subj.name %>").css("display", "none");

    function load_<%= col.name %>() {
        var i = 1;
        $("#<%= col.name %>").DataTable().destroy();
        $("#<%= col.name %>").DataTable({
            ajax: {
                url : '../ajax/load_colg',
                method : 'POST'
            },
            columns: [
                {data: function(){
                    return i++;
                }},
                <% col.column_data.forEach(function(item){ %>
                {data: "<%= item %>"},
                <% }) %>
                {
                    data: function (data) {
                        var dept_btn = '<a class="btn blue btn-outline" href="javascript:load_<%= dept.name %>(' + data.<%= col.column_data[0] %>+ ')" target="_blank">DEPARTMENTS</a>';
                        var del_btn = '<a class="btn red btn-outline" href="javascript:del_colg(' + data.<%= col.column_data[0] %>+ ')" target="_blank">DELETE</a>';

                        var btns = dept_btn + " " + del_btn;

                        return btns;
                    }
                }
            ]
        });
    }

    load_<%= col.name %>();


    function load_<%= dept.name %>(id) {
        var i = 1;

        $('.col_id').val(id);
        $('.col_id').prop("readonly", true);
        $('.dept_id').val('');
        $('.dept_id').prop("readonly", false);

        $('.div-<%= profs.name %>').css("display", "none");
        $('.div-<%= subj.name %>').css("display", "none");

        $("#<%= dept.name %>").DataTable().destroy();
        $("#<%= dept.name %>").DataTable({
            ajax: {
                url: '../ajax/load_dept',
                data: {col_id: id},
                method: 'POST'
            },
            columns: [
                {data: function(){
                    return i++;
                }},
                <% dept.column_data.forEach(function(item){ %>
                {data: "<%= item %>"},
                <% }) %>
                {
                    data: function (data) {
                        var profs_btn = '<a class="btn blue btn-outline" href="javascript:load_<%= profs.name %>(' + data.<%= dept.column_data[0] %>+ ','+id+')" target="_blank">PROFESSORS</a>';
                        var subj_btn = '<a class="btn blue btn-outline" href="javascript:load_<%= subj.name %>(' + data.<%= dept.column_data[0] %>+ ','+id+')" target="_blank">SUBJECTS</a>';
                        var del_btn = '<a class="btn red btn-outline" href="javascript:del_dept(' + data.<%= dept.column_data[0] %>+ ', '+id+')" target="_blank">DELETE</a>';

                        var btns = profs_btn + subj_btn + del_btn;

                        return btns;
                    }
                }
            ]

        });

        $('.div-<%= dept.name %>').css("display", "block");
    }

    function load_<%= subj.name %>(id, colg_id) {
        var i = 1;
        $('.dept_id').val(id);
        $('.dept_id').prop("readonly", true);

        $("#<%= subj.name %>").DataTable().destroy();
        $("#<%= subj.name %>").DataTable({
            ajax: {
                url: '../ajax/load_sub',
                data: {dept_id: id, col_id: colg_id},
                method: 'POST'
            },
            columns: [
                {data: function(){
                    return i++;
                }},
                <% subj.column_data.forEach(function(item){ %>
                {data: "<%= item %>"},
                <% }) %>
                {
                    data: function (data) {
                        var del_btn = '<a class="btn red btn-outline" href="javascript:del_subj(' + data.<%= subj.column_data[0] %>+ ', '+id+ ', '+colg_id+ ')" target="_blank">DELETE</a>';

                        var btns = del_btn;

                        return btns;
                    }
                }
            ]

        });
        $('.div-<%= subj.name %>').css("display", "block");
    }

    function load_<%= profs.name %>(id, colg_id) {
        var i = 1;

        $('.dept_id').val(id);
        $('.dept_id').prop("readonly", true);

        $("#<%= profs.name %>").DataTable().destroy();
        $("#<%= profs.name %>").DataTable({
            ajax: {
                url: '../ajax/load_prof',
                data: {dept_id: id, col_id: colg_id},
                method: 'POST'
            },
            columns: [
                {data: function(){
                    return i++;
                }},
                <% profs.column_data.forEach(function(item){ %>
                {data: '<%= item %>'},
                <% }); %>
                {
                    data: function (data) {
                        var del_btn = '<a class="btn red btn-outline" href="javascript:del_profs(' + data.<%= profs.column_data[0] %>+ ', '+id+ ', '+colg_id+ ')" target="_blank">DELETE</a>';

                        var btns = del_btn;

                        return btns;
                    }
                }
            ]

        });

        $('.div-<%= profs.name %>').css("display", "block");
    }

    function del_colg(id) {
        $.ajax({
            url: '../ajax/del_col',
            data: {col_id: id},
            method: 'POST',
            success: function (data) {
                load_<%= col.name %>();
                //toast the success message
            },
            error: function (data) {
                //toast the error out
            }
        });
    }

    function del_dept(id, colg_id) {
        $.ajax({
            url: '../ajax/del_dept',
            data: {col_id: colg_id, dept_id: id},
            method: 'POST',
            success: function (data) {
                setTimeout(function(){load_<%= dept.name %>(colg_id);}, 150);

                //toast the success message
            },
            error: function (data) {
                //toast the error out
            }
        });
    }

    function del_subj(id, dept_id, colg_id) {
        $.ajax({
            url: '../ajax/del_subj',
            data: {sub_id: id, dept_id : dept_id, col_id: colg_id},
            method: 'POST',
            success: function (data) {
                load_<%= subj.name %>(dept_id, colg_id);
                //toast the success message
            },
            error: function (data) {
                //toast the error out
            }
        });
    }

    function del_profs(id, dept_id, colg_id) {
        $.ajax({
            url: '../ajax/del_prof',
            data: {prof_id: id, dept_id: dept_id, col_id: colg_id},
            method: 'POST',
            success: function (data) {
                load_<%= profs.name %>(dept_id, colg_id);
                console.log('Professor deleted : ' + data);
                //toast the success message
            },
            error: function (data) {
                console.log('Professor not deleted. '+data.responseText);
                //toast the error out
            }
        });
    }

    function del_dept(id, colg_id) {
        $.ajax({
            url: '../ajax/del_dept',
            data: {dept_id: id, col_id: colg_id},
            method: 'POST',
            success: function (data) {
                load_<%= dept.name %>(colg_id);
                //toast the success message
            },
            error: function (data) {
                //toast the error out
            }
        });
    }

    $('.div_m_col').on('click', '.m_col', function(e){
        e.preventDefault();

        $.ajax({
            url: '../ajax/add_col',
            data: $('#form-m_col').serialize(),
            method: 'POST',
            success: function(data){
                $('.close-m_col').click();
                load_<%= col.name %>();
            },
            error: function(data){
                console.log("Error occured while adding college! "+data.responseText);
            }
        });
    });

    $('.div_m_dept').on('click', '.m_dept', function(e){
        e.preventDefault();

        $.ajax({
            url: '../ajax/add_dept',
            data: $('#form-m_dept').serialize(),
            method: 'POST',
            success: function(data){
                $('.close-m_dept').click();
                load_<%= dept.name %>($('.col_id').val());
            },
            error: function(data){
                console.log("Error occured while adding department! "+ data.responseText);
            }
        });

    });

    $('.div_m_prof').on('click', '.m_prof', function(e){
        e.preventDefault();

        $.ajax({
            url: '../ajax/add_prof',
            data: $('#form-m_prof').serialize(),
            method: 'POST',
            success: function(data){
                $('.close-m_prof').click();
                load_<%= profs.name %>($('.dept_id').val(), $('.col_id').val());
            },
            error: function(data){
                console.log("Error occured while adding professor! "+data.responseText);
            }
        });
    });

    $('.div_m_subj').on('click', '.m_subj', function(e){
        e.preventDefault();

        $.ajax({
            url: '../ajax/add_subject',
            data: $('#form-m_subj').serialize(),
            method: 'POST',
            success: function(data){
                $('.close-m_subj').click();
                load_<%= subj.name %>($('.dept_id').val(), $('.col_id').val());
            },
            error: function(data){
                console.log("Error occured while adding subject! "+data.responseText);
            }
        });
    });

    $('#col_modal_btn').on('click', function(){

        $('.div-<%= dept.name %>').css("display", "none");
        $('.div-<%= subj.name %>').css("display", "none");
        $('.div-<%= profs.name %>').css("display", "none");
        $('.col_id').val('');
       $('.col_id').prop("readonly", false);
    });

</script>

</body>

</html>